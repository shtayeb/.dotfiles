# Zsh installation and setup

- name: Install zsh
  become: true
  apt:
    name: zsh
    state: present
  tags: [install, zsh]

- name: Change default shell to zsh
  become: true
  user:
    name: "{{ ansible_user_id }}"
    shell: /usr/bin/zsh
  tags: [install, zsh]

# Fonts (user space)
- name: Ensure fonts directory exists
  file:
    path: "{{ home_dir }}/.fonts"
    state: directory
    mode: '0755'
  tags: [install, zsh]

- name: Check if Hack Nerd Font exists
  find:
    paths: "{{ home_dir }}/.fonts"
    patterns: "Hack*Nerd*"
  register: hack_font
  tags: [install, zsh]

- name: Download Hack Nerd Font
  when: hack_font.matched == 0
  unarchive:
    src: https://github.com/ryanoasis/nerd-fonts/releases/download/v3.1.1/Hack.zip
    dest: "{{ home_dir }}/.fonts/"
    remote_src: yes
  tags: [install, zsh]

- name: Refresh font cache
  when: hack_font.matched == 0
  shell: fc-cache -fv
  changed_when: false
  tags: [install, zsh]
